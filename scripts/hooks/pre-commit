#!/usr/bin/env bash
set -euo pipefail

# Skip if explicitly disabled
[ -n "${SKIP_GEN:-}" ] && exit 0

ROOT_DIR="$(git rev-parse --show-toplevel)"
cd "$ROOT_DIR"

# Run binding generation
pnpm gen:bindings

# Stage generated outputs if they were regenerated
git add apps/repo-manage/src/bindings/types.ts 2>/dev/null || true
git add apps/repo-manage/src/bindings/commands.ts 2>/dev/null || true
git add apps/repo-manage/core/src/generated/types.rs 2>/dev/null || true

# Stage formatted markdown files (fixes flapping rumdl fmt)
git add docs/src/content/docs/*.mdx 2>/dev/null || true
